{% extends 'base_course.html' %}

{% block subtitle %}
{# I18N: Title of the G-Defier block webpage. #}
Arena
{% endblock subtitle %}

{% block top_content %}
  <a href="gDefier/block?title={{defy.block_board.blockID}}">
  Go to block "{{defy.block_board.blockID}}"
  </a>
  <div class="gcb-cols">
	<h1 class="gcb-col-12 gcb-aside" align="center" style="color:#F44F4F">
	{{defy.lname}} VS {{defy.rname}}
	</h1>
</div>
{% endblock %}

{% block main_content %}

{% if side == 'left' %}
	{% set side_ended = defy.lended %}
	{% set defy_round = defy.lround %}
{% else %}
	{% set side_ended = defy.rended %}
	{% set defy_round = defy.rround %}
{% endif %}

{% if not side_ended%}
	<div align=center class= "container">
		<div class="countdown retro" id="countdown"></div>
	</div>
	{% for number in range(rounds) %}
		{% if number==0 %}
			<br><br>
		    <button class="push_button" id="first">START</button>
		{% elif number==rounds-1 %}
			<button class="push_button" id="last">LAST</button>
		{% else %}
			<button class="push_button" id="next{{number}}" onclick="next_button({{number}})">NEXT</button>
		{% endif %}
	 	<div align=center id="khan{{number+1}}">
			{{ questions[number] | gcb_tags}}
		</div>
	{% endfor %}
{% else %}
<div align=center class= "container">
	<div class="lname" align="left">
		{{defy.lscore}}
		{{defy.lended}}
	</div>
	<div class="rname" align="right">
		{{defy.rscore}}
		{{defy.rended}}
	</div>
</div>	
{% endif %}

<style type="text/css">
{% include 'resources/css/buttons.css' %}
{% include 'resources/css/buttons2.css' %}
{% include 'resources/countdown/style.css' %}

{% if defy_round == 0 %}
#last, [id^="next"], [id^="khan"], #countdown{
display: none;
}
{% else %}
	{% if rounds <=  2 %}
	#first, [id^="khan"], #countdown{
	display: none;
	}
	{% elif rounds == defy_round+1 %}	
	#first, [id^="next"], [id^="khan"], #countdown {
	display: none;
	}	
	{% else %}
	#first, #last, [id^="next"], [id^="khan"], #countdown {
	display: none;
	}	
	[id$="next{{defy_round}}"] {
	display: inline;
	}	
	{% endif %}
{% endif %}	
	
</style>

<script type='text/javascript'>

{% include 'resources/countdown/jquery.countdown.js' %}

var t_round = "{{ t_round }}";
//var counter = 60000 * t_round;
var counter = 10000;

var rounds = "{{ rounds }}";
var defy_round = "{{ defy_round }}";

$( "#first" ).click(function() {
	$( "#countdown" ).show( "fast");
	$( "#khan1" ).show("fast");
	$( "#first" ).hide();
	if (rounds != 1)
		$.post( window.location, { button: 1, side: "{{side}}"});
	countdown(counter);
    setTimeout(function() {
    	$( "#khan1" ).hide();
    	if (rounds>2){
    		$("#next1").show("fast");    		
    	} else if (rounds==2){
    		$( "#last" ).show("fast");
    	} else {
        	window.location = window.location + '&end={{side}}';
    	}
    }, counter);
});

function next_button(i) {
	$("#khan"+(i+1).toString()).show("fast");
	$("#next"+(i).toString()).hide();
	$.post( window.location, { button: i+1, side: "{{side}}"});
	if (defy_round>0){
		$( "#countdown" ).show( "fast");
		countdown(counter);
	}else
		update_countdown(counter);
    setTimeout(function() {
    	$("#khan"+(i+1).toString()).hide();
		if (i == rounds-2){
			$("#last").show("fast");
		}else{
			$("#next"+(i+1).toString()).show("fast");
		}
    }, counter);
}

$( "#last" ).click(function() {
	if (rounds==2)
		$( "#khan2" ).show( "fast");
	else if (rounds>2)
		$("#khan"+rounds.toString()).show( "fast");
	
	$( "#last" ).hide();
	if (defy_round>0){
		$( "#countdown" ).show( "fast");
		countdown(counter);
	}else
		update_countdown(counter);
    setTimeout(function() {
    	$("#khan"+rounds.toString()).hide();
    	window.location = window.location + '&end={{side}}';
    }, counter);
});

function countdown(counter) {
	  $('.countdown.retro').countdown({
	    date: +(new Date) + counter,
	    render: function(data) {
	        $(this.el).text(this.leadingZeros(data.min, 2) + " min and " + this.leadingZeros(data.sec, 2) + " sec");
	    },
	    onEnd: function() {
	      $(this.el).addClass('ended');
	    }
	});
}	  
function update_countdown(counter) {
       $('.countdown.retro').removeClass('ended').data('countdown').update(+(new Date) + counter).start();
}
</script>

{% endblock %}
